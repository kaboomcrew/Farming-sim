<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>HTML Template</title>
</head>
<style>
    body {
        background-color: green;
    }
    .Plant {
        position: relative;
        flex: 1;
        height: 100%;
        max-width: 100%;
        display: flex;
        justify-content: center;
        align-items: flex-end;
    }

    .PPStem1 {
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        height: 10px;
        width: 12px;
        background-color: rgb(0, 184, 0);
        border-right: rgb(0, 131, 0) 5px solid;
        border-top-right-radius: 25px;
        border-top-left-radius: 25px;
        box-shadow: 2px 2px;
    }

    .LeafForward {
        position: absolute;
        width: 40px;
        height: 30px;
        left: 25%;
        bottom: 120px;
        background-color: green;
        border-bottom-left-radius: 25px;
        border-top-left-radius: 40px;
        border-bottom-right-radius: 10px;
        border-top-right-radius: 10px;
        border-bottom: lightgreen solid 1px;
        border-left: lightgreen solid 1px;
        box-shadow: 2px 2px;
    }

    .LeafBackwards {
        position: absolute;
        width: 40px;
        height: 30px;
        right: 25%;
        bottom: 120px;
        background-color: green;
        border-bottom-left-radius: 10px;
        border-top-left-radius: 10px;
        border-bottom-right-radius: 25px;
        border-top-right-radius: 40px;
        border-bottom: lightgreen solid 1px;
        border-left: lightgreen solid 1px;
        box-shadow: 2px 2px;
    }



    .Potato {
        position: absolute;
        bottom: 0px;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 20px;
        border-top-left-radius: 50px;
        border-top-right-radius: 50px;
        background-color: rgb(149, 105, 59);
        z-index: 1;
        border-left: rgb(164, 124, 82) solid 5px;
        box-shadow: 2px 2px;
    }

    .Container {
        align-items: center;
        height: 500px;
        width: 100%;
    }

    .Plot {
        flex: 1 0 100px;
        max-width: 160px;
        /* Prevents them from growing too large */
        height: 160px;
        background-color: rgb(75, 58, 48);
        border-bottom: rgb(101, 87, 84) 15px solid;
        text-align: center;
    }

    .PlantContainer {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 160px;
        width: 150px;
        overflow: visible;
        gap: 0;
    }

    .Farms {
        display: flex;
        flex-wrap: nowrap;
        /* No wrapping */
        gap: 0px;
        /* Small gap between plots */
        justify-content: left;
        /* Aligns to the left */
        width: 100%;
        /* Ensures it takes up available space */
    }

    .PlantOptions {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        height: 500px;
        width: 400px;
        background-color: aliceblue;
        border-radius: 50px;
        border: none;
        box-shadow: 5px 5px black;
        z-index: 1;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        text-align: center;
    }

    .MenuTitle {
        color: white;
        font-size: 60px;
        -webkit-text-stroke: 2px black;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .PlantOptionsButton {
        background-color: crimson;
        border: 15px solid brown;
        border-radius: 25px;
        height: 75px;
        width: 275px;
        color: white;
        font-size: 20px;
        transition: ease 500ms;
    }

    .PlantOptionsButton:hover {
        background-color: rgb(226, 72, 103);
        border: 15px solid rgb(235, 32, 32);
        border-radius: 25px;
        height: 75px;
        width: 275px;
        color: white;
        font-size: 20px;
    }

    .Carrot {
        position: absolute;
        bottom: 0px;
        left: 50%;
        transform: translateX(-50%);
        width: 30px;
        height: 20px;
        border-top-left-radius: 10px;
        border-top-right-radius: 10px;
        border-bottom-left-radius: 10%;
        border-bottom-right-radius: 10%;
        background-color: rgb(223, 100, 0);
        z-index: 1;
        border-left: rgb(209, 124, 33) solid 5px;
        box-shadow: 2px 2px;
    }

    .WorkerBot {
        position: fixed;
        top: 0px;
        left: 0px;
        background-color: black;
        height: 100px;
        width: 100px;
        transition: left 0.5s, top 0.5s;
    }
    .ExitButton {
        position: fixed;
        right: -25px;
        top: -25px;
        height: 100px;
        width: 100px;
        border-radius: 50px;
        border: solid brown 15px;
        background-color: crimson;
        color: white;
        font-family: cursive;
        font-size: 50px;
        transition: ease 500ms;
    }
    .ExitButton:hover {
        background-color: rgb(226, 72, 103);
        border: 15px solid rgb(235, 32, 32);
        border-radius: 25px;
    }
    .UpgradeConfirmation {
        display: none;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        height: 500px;
        width: 400px;
        background-color: white;
        border-radius: 50px;
        box-shadow: 2px 2px black;
    }
</style>

<body>
    <p id="OutputText">Hi</p>
    <div id="Container"></div>

    <div class="Plant" style="display: none;" id="CopyablePatatoPlant">
        <div class="PPLVL1" style="visibility: hidden;">
            <div class="PPStem1"></div>
        </div>
        <div class="PPLVL2" style="visibility: hidden;">
            <div class="PPStem1" style="height: 50px;"></div>
        </div>
        <div class="PPLVL3" style="visibility: hidden;">
            <div class="Potato"></div>
            <div class="PPStem1" style="height: 150px;"></div>
            <div class="LeafForward"></div>
            <div class="LeafBackwards" style="bottom: 75px;"></div>
        </div>
    </div>
    <div class="Plant" style="display: none;" id="CopyableCarrotPlant">
        <div class="PPLVL1" style="visibility: hidden;">
            <div class="PPStem1"></div>
        </div>
        <div class="PPLVL2" style="visibility: hidden;">
            <div class="PPStem1" style="height: 50px;"></div>
        </div>
        <div class="PPLVL3" style="visibility: hidden;">
            <div class="Carrot"></div>
            <div class="PPStem1" style="height: 150px;"></div>
            <div class="LeafForward"></div>
            <div class="LeafBackwards" style="bottom: 75px;"></div>
        </div>
    </div>

    <p>Dollars: <a id="Money"></a></p>
    <div class="MainGUI" id="MainGUI">
        <section id="PlantOptions" class="PlantOptions" style="display: none;">
            <button id="ExitButton" class="ExitButton">X</button>

            <h3 class="MenuTitle">Plant</h3>

            <button class="PlantOptionsButton" id="GrowPatato">Patato Buy: $5 Sell: $7</button>
            <br>
            <button class="PlantOptionsButton" id="GrowCarrot">Carrot Buy: $25 Sell: $35</button>

        </section>
        <section id="UpgradeConfirmation" class="UpgradeConfirmation">
            <button id="ExitButton" class="ExitButton">X</button>
            <div style="position: fixed; left: 50%; transform: translate(-50%);">
                <h3 class="MenuTitle">Upgrade</h3>
                <button id="UpgradeButton" class="PlantOptionsButton">Upgrade $<a id="RequestedUpgradePrice"></a></button>
            </div>
        </section>
    </div>


    <div id="Farms" class="Farms">


        <div id="Plot1" class="Plot">
            <span>
                <button onclick="GrowOptions(this.parentElement.parentElement.id, this)">Grow</button>
                <button onclick="OpenUpgradeUI(this.parentElement.parentElement.id)">Upgrade</button>
            </span>
            <div id="PlantContainer1" class="PlantContainer"></div>
        </div>

        <div id="Plot2" class="Plot">
            <span>
                <button onclick="GrowOptions(this.parentElement.parentElement.id, this)">Grow</button>
                <button onclick="OpenUpgradeUI(this.parentElement.parentElement.id)">Upgrade</button>
            </span>
            <div id="PlantContainer2" class="PlantContainer"></div>
        </div>

        <div id="Plot3" class="Plot">
            <span>
                <button onclick="GrowOptions(this.parentElement.parentElement.id, this)">Grow</button>
                <button onclick="OpenUpgradeUI(this.parentElement.parentElement.id)">Upgrade</button>
            </span>
            <div id="PlantContainer3" class="PlantContainer"></div>
        </div>

        <div id="Plot4" class="Plot">
            <span>
                <button onclick="GrowOptions(this.parentElement.parentElement.id, this)">Grow</button>
                <button onclick="OpenUpgradeUI(this.parentElement.parentElement.id)">Upgrade</button>
            </span>
            <div id="PlantContainer4" class="PlantContainer"></div>
        </div>

        <div id="Plot5" class="Plot">
            <span>
                <button onclick="GrowOptions(this.parentElement.parentElement.id, this)">Grow</button>
                <button onclick="OpenUpgradeUI(this.parentElement.parentElement.id)">Upgrade</button>
            </span>
            <div id="PlantContainer5" class="PlantContainer"></div>
        </div>

        <div class="WorkerBot" id="WorkerBot"></div>
    </div>

    <script>

        function OpenUpgradeUI(plot) {
            const UpgradeUI = document.getElementById("UpgradeConfirmation");
            UpgradeUI.style.display = "block";

            document.getElementById("UpgradeButton").onclick = function()  {
                Upgrade(plot)
                UpgradeUI.style.display = "none";
            }
            
        }

        const workerBot = document.getElementById("WorkerBot");
        let workerQueue = []
        document.addEventListener("click", (event) => {
            if (event.target.tagName.toLowerCase() === "button") { return }
            var PosX = event.clientX;
            var PosY = event.clientY;
            PosX -= 50; /* Gets the middle of the Worker */
            PosY -= 50
            workerBot.style.left = PosX + "px";
            workerBot.style.top = PosY + "px";
        });

        function queueWorkerTask(plot, task) {
            workerQueue.push({ plot, task });
            if (workerQueue.length === 1) processWorkerTasks();
        }

        function processWorkerTasks() {
            if (workerQueue.length === 0) return;
            const { plot, task } = workerQueue.shift();
            moveWorkerTo(plot, () => {
                setTimeout(processWorkerTasks, 1000);
            });
        }

        function moveWorkerTo(plot, callback) {
            const PlotRect = document.getElementById(plot);
            workerBot.style.transition = "left 0.5s, top 0.5s";
            const rect = PlotRect.getBoundingClientRect();
            workerBot.style.left = `${rect.left}px`;
            workerBot.style.top = `${rect.top}px`;
            setTimeout(callback, 500);
        }



        const CopyablePatatoPlant = document.getElementById("CopyablePatatoPlant");
        const CopyableCarrotPlant = document.getElementById("CopyableCarrotPlant");
        var Dollars = 0;

        let PlotData = [];

        function AddPlotToData(ID) {
            let DataString = ID.toString() + " 1 false none"; // id, how many plants can grow on that tile, if something is growing on it, type of crop growing // 
            PlotData.push(DataString);
        }

        const Farms = document.getElementById("Farms");
        if (Farms) {
            const Farms2 = Farms.children;
            for (let i = 0; i < Farms2.length; i++) {
                const Farm = Farms2[i];
                AddPlotToData(Farm.id);
            }
        } else { }

        function Upgrade(Plot) {
            let PlotNumInList = Number(Plot.replace("Plot", "")) - 1;
            let PlotInfo = PlotData[PlotNumInList].split(" ");

            let PlantCounter = Number(PlotInfo[1]);
            PlantCounter += 1;

            PlotInfo[1] = PlantCounter;

            let ReturningString = PlotInfo[0] + " " + PlotInfo[1] + " " + PlotInfo[2] + " " + PlotInfo[3];
            PlotData[PlotNumInList] = ReturningString;
        }


        function GrowOptions(Plot, button) {
            let PlotNumInList = Number(Plot.replace("Plot", "")) - 1;
            let PlotInfo = PlotData[PlotNumInList].split(" ");
            if (PlotInfo[2] == "sell") {
                Grow(Plot, button)
                queueWorkerTask(Plot, "grow");
                return
            } else if (PlotInfo[2] == "false") {
                const OptionUI = document.getElementById("PlantOptions");
                OptionUI.style.display = "block";

                let SendPlot = Plot
                let SendButton = button

                document.getElementById("GrowPatato").onclick = function () {
                    Grow(SendPlot, SendButton, "Patato")
                    queueWorkerTask(Plot, "grow");
                }
                document.getElementById("GrowCarrot").onclick = function () {
                    Grow(SendPlot, SendButton, "Carrot")
                    queueWorkerTask(Plot, "grow");
                }
                document.getElementById("ExitButton").onclick = function () {
                    const OptionUI = document.getElementById("PlantOptions");
                    OptionUI.style.display = "none";
                }
            }
        }


        function Grow(Plot, Button, Plant) {

            const OptionUI = document.getElementById("PlantOptions");
            OptionUI.style.display = "none";

            let PlotNumInList = Number(Plot.replace("Plot", "")) - 1;
            let PlotInfo = PlotData[PlotNumInList].split(" ");
            let PlantContainer = document.getElementById("PlantContainer" + (PlotNumInList + 1));

            if (PlotInfo[2] === "false") {
                PlotInfo[2] = "true";
                PlotData[PlotNumInList] = `${PlotInfo[0]} ${PlotInfo[1]} ${PlotInfo[2]} ${PlotInfo[3]}`;

                for (let i = 0; i < PlotInfo[1]; i++) {
                    let NewPatato = 0;
                    if (Plant == "Patato") {
                        NewPatato = CopyablePatatoPlant.cloneNode(true);
                        PlotInfo[3] = "Patato";
                    }
                    if (Plant == "Carrot") {
                        NewPatato = CopyableCarrotPlant.cloneNode(true);
                        PlotInfo[3] = "Carrot";
                    }

                    NewPatato.style.display = "block";
                    PlantContainer.appendChild(NewPatato);

                    const children = NewPatato.children;
                    for (let j = 0; j < children.length; j++) {
                        setTimeout(() => {
                            children[j].style.visibility = "visible";

                            if (j == (children.length - 1)) {
                                Button.innerHTML = "Sell";

                                PlotInfo[2] = PlotInfo[2].replace("true", "sell");

                                let ReturningString = PlotInfo[0] + " " + PlotInfo[1] + " " + PlotInfo[2] + " " + PlotInfo[3];
                                PlotData[PlotNumInList] = ReturningString;
                            }
                        }, j * 4000);
                    }
                }

            } else if (PlotInfo[2] === "sell") {


                const FarmPlot = document.getElementById("PlantContainer" + (PlotNumInList + 1));
                const crops = Array.from(FarmPlot.children);

                crops.forEach(crop => crop.remove());


                PlotInfo[2] = PlotInfo[2].replace("sell", "false");
                PlotInfo[3] = "none";

                let ReturningString = PlotInfo[0] + " " + PlotInfo[1] + " " + PlotInfo[2] + " " + PlotInfo[3];
                PlotData[PlotNumInList] = ReturningString;
                Button.innerHTML = "Grow";
            }
        }

    </script>

</body>

</html>
